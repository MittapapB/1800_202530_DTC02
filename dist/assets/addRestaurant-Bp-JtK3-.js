import{b as v,d as I,i as B,r as h,s as w,u as L,e as P,j as N}from"./firebaseConfig-BGUxOqTk.js";/* empty css              */import{B as _}from"./BackButton-VMeNE0XH.js";import{N as b}from"./Navbar-CLB9A0dp.js";document.body.appendChild(_({target:"main.html"}));document.getElementById("navbar").appendChild(b());const y=document.getElementById("addRestaurantForm");document.getElementById("confirmation");window.initPlaces=function(){const t=document.getElementById("restaurantName"),a=document.getElementById("address"),r=new google.maps.places.Autocomplete(t,{types:["establishment"],componentRestrictions:{country:"ca"}});r.addListener("place_changed",()=>{const n=r.getPlace();n&&n.name&&(t.value=n.name),n.formatted_address&&(a.value=n.formatted_address,i("addressError"))})};function m(t,a){const r=document.getElementById(t);r&&(r.textContent=a,r.classList.remove("hidden"))}function i(t){const a=document.getElementById(t);a&&a.classList.add("hidden")}function D(){let t=!0;const a=document.getElementById("restaurantName"),r=document.getElementById("address"),n=document.getElementById("cuisineType"),f=document.getElementById("image"),c=a.value.trim(),l=r.value.trim(),u=n.value.trim(),g=f.files[0];i("restaurantNameError"),i("addressError"),i("cuisineError"),i("imageError"),c||(m("restaurantNameError","Please enter the restaurant name."),t=!1),l||(m("addressError","Address is required."),t=!1),u&&/\d/.test(u)&&(m("cuisineError","Numbers are not allowed in cuisine types."),t=!1);const s=2*1024*1024;return g&&g.size>s&&(m("imageError","Please upload an image smaller than 2MB."),t=!1),{isValid:t,name:c,address:l,cuisine:u,imageFile:g}}document.getElementById("restaurantName").addEventListener("input",t=>{t.target.value.trim()?i("restaurantNameError"):m("restaurantNameError","Please enter the restaurant name.")});document.getElementById("address").addEventListener("input",t=>{const a=t.target.value.trim();/^\d+\s?[A-Za-z].*$/.test(a)?i("addressError"):m("addressError","Address must include street number and street name.")});document.getElementById("cuisineType").addEventListener("input",t=>{const a=t.target.value.trim();/\d/.test(a)?m("cuisineError","Numbers are not allowed in cuisine types."):i("cuisineError")});document.getElementById("image").addEventListener("change",t=>{const a=e.target.files[0];a&&a.size>2*1024*1024?m("imageError","Please upload an image smaller than 2MB."):i("imageError")});y.addEventListener("submit",async t=>{t.preventDefault();const{isValid:a,name:r,address:n,cuisine:f,imageFile:c}=D();if(!a)return;const l=(r+"_"+n).toLowerCase().replaceAll(" ","_").replaceAll(",","").replaceAll(".","");try{const s=v(I,"restaurant",l);if((await B(s)).exists()){const d=document.getElementById("errorMsg");d.textContent="This restaurant already exists!",d.classList.remove("hidden"),d.style.opacity="1",setTimeout(()=>{d.style.opacity="0"},3e3);return}let p="";if(c){const d=`restaurant_images/${l}/${Date.now()}-${c.name}`,E=h(w,d);await L(E,c),p=await P(E)}await N(s,{name:r,address:n,cuisine:f||"",image_url:p,avg_wait_time:0}),g("Restaurant added successfully!"),y.reset(),setTimeout(()=>{const d=encodeURIComponent(l),E="restaurant-info.html";window.location.href=`${E}?restaurant-id=${d}`},3e3)}catch(s){console.error("Error adding restaurant:",s),u("Failed to add restaurant. Please try again.")}function u(s){const o=document.getElementById("errorMsg");o.textContent=s,o.classList.remove("hidden"),o.style.opacity="1",setTimeout(()=>{o.style.opacity="0"},3e3)}function g(s){const o=document.getElementById("confirmation");o.textContent=s,o.classList.remove("hidden"),o.style.opacity="1",setTimeout(()=>{o.style.opacity="0"},3e3)}});
