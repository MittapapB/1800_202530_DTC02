import{b as R,d as p,i as w,o as S,T as $,v as L,c as P,w as U,h as x,a as A}from"./firebaseConfig-BGUxOqTk.js";/* empty css              */import{B as N}from"./BackButton-VMeNE0XH.js";import{N as k}from"./Navbar-CLB9A0dp.js";const M=new URL(window.location.href),q=decodeURIComponent(M.searchParams.get("restaurant-id"));document.body.appendChild(N({target:`restaurant-info.html?restaurant-id=${encodeURIComponent(q)}`}));document.getElementById("navbar").appendChild(k());const o=document.getElementById("star-rating"),u=e=>{[...o.querySelectorAll("svg")].forEach(t=>{const a=Number(t.dataset.value||0);t.setAttribute("fill",a<=e?"#fa9500":"none")}),o.dataset.rating=String(e)};let v=0;o&&o.addEventListener("click",e=>{const t=e.target.closest("svg");t&&(v=Number(t.dataset.value||0),u(v))});u(0);const F=new URL(window.location.href),d=decodeURIComponent(F.searchParams.get("restaurant-id")),m=R(p,"restaurant",d),f=await w(m);f.exists()&&(document.getElementById("restaurant-name").textContent=f.data().name);S(A,e=>{const t=document.getElementById("add-time-form"),a=document.getElementById("errorMsg"),c=document.getElementById("confirmation"),y=n=>{a.textContent=n,a.classList.remove("hidden"),a.style.opacity="1",setTimeout(()=>{a.style.opacity="0"},3e3)},h=n=>{c.textContent=n,c.classList.remove("hidden"),c.style.opacity="1"};t.addEventListener("submit",async n=>{if(n.preventDefault(),!e){alert("Please sign in first.");return}try{const r=parseInt(document.getElementById("waiting-time").value),I=document.getElementById("record-date").value,b=document.getElementById("record-time").value,E=new Date(`${I}T${b}`),_=$.fromDate(E),B=(document.getElementById("feedback").value||"").trim(),C=Number(o.dataset.rating||0);await L(P(p,"restaurant",d,"time_record"),{user_id:e.uid,wait_time_minutes:r,visit_timestamp:_,rating:C,comments:B,submitted_at:U()});const l=await w(m);if(l.exists()){const s=l.data(),i=s.total_record_number||0,T=s.avg_wait_time||0,g=i+1,D=(T*i+r)/g;await x(m,{total_record_number:g,avg_wait_time:D})}h("Record submitted sucessfully!"),t.reset(),u(0),setTimeout(()=>{const s=encodeURIComponent(d),i="restaurant-info.html";window.location.href=`${i}?restaurant-id=${s}`},3e3)}catch(r){console.error(r),y("Failed to submit record. Please try again.");return}})});
