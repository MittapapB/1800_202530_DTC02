import{o as E,a as L,b as p,d as g,r as v,s as w,u as D,e as N,f as I,h as P,i as C,j as R}from"./firebaseConfig-BGUxOqTk.js";/* empty css              */import{b as A}from"./authentication-CA3jcVaF.js";import{B as F}from"./BackButton-VMeNE0XH.js";import{N as U}from"./Navbar-CLB9A0dp.js";let o=null;function B(){console.log("Initializing profile page...");const i=document.getElementById("toLogout"),d=document.getElementById("authButtons"),a=document.getElementById("userName"),s=document.getElementById("profileImage"),c=document.getElementById("profileImageInput"),u=document.getElementById("updateProfileBtn"),n=document.getElementById("profileFormContainer"),y=document.getElementById("profileForm"),h=document.getElementById("closeFormBtn");console.log("Elements found:",{logoutBtn:!!i,userName:!!a,profileImage:!!s,fileInput:!!c,updateProfileBtn:!!u,formContainer:!!n,profileForm:!!y,closeFormBtn:!!h}),c?.addEventListener("change",async e=>{const t=e.target.files[0];if(!(!t||!o))try{const l=p(g,"users",o.uid),m=`user_profiles/${o.uid}/${Date.now()}-${t.name}`,r=v(w,m);await D(r,t);const f=await N(r);await I(o,{photoURL:f}),await P(l,{avatar:f,updatedAt:Date.now()}),s.src=f,alert("Profile image updated successfully!")}catch(l){console.error("Upload failed:",l),alert("Failed to upload image. Please try again.")}}),u?.addEventListener("click",async()=>{if(!o){alert("Please sign in to update your profile.");return}try{const e=p(g,"users",o.uid),t=await C(e);if(t.exists()){const l=t.data();document.getElementById("fullNameInput").value=l.fullName||"",document.getElementById("phoneInput").value=l.phone||"",document.getElementById("cityInput").value=l.city||""}n.classList.remove("hidden"),n.classList.add("flex")}catch(e){console.error("Error loading profile data:",e),alert("Error loading profile data.")}}),h?.addEventListener("click",()=>{n.classList.add("hidden"),n.classList.remove("flex")}),y?.addEventListener("submit",async e=>{if(e.preventDefault(),!o)return;const t=document.getElementById("fullNameInput").value.trim(),l=document.getElementById("phoneInput").value.trim(),m=document.getElementById("cityInput").value.trim();try{const r=p(g,"users",o.uid);await R(r,{fullName:t,phone:l,city:m,updatedAt:Date.now()},{merge:!0}),t&&t!==o.displayName&&await I(o,{displayName:t}),alert("Profile information updated successfully!"),n.classList.add("hidden"),n.classList.remove("flex"),a&&(a.textContent=t||o.email)}catch(r){console.error("Error updating profile:",r),alert("Could not update your profile. Please try again.")}}),E(L,e=>{if(console.log("Auth state changed:",e),!e){window.location.href="/src/pages/sign-in.html";return}o=e,d&&d.classList.add("hidden"),a&&(a.textContent=e.displayName||e.email,a.classList.remove("hidden")),s&&e.photoURL&&(s.src=e.photoURL)}),i?.addEventListener("click",e=>{e.preventDefault(),A()})}function b(i){const d=document.getElementById(`content-${i}`),a=document.getElementById(`icon-${i}`),s=document.querySelectorAll('[id^="content-"]'),c=document.querySelectorAll('[id^="icon-"]'),u=!d.classList.contains("hidden");s.forEach(n=>n.classList.add("hidden")),c.forEach(n=>n.classList.remove("rotate-180")),u||(d.classList.remove("hidden"),a&&a.classList.add("rotate-180"))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B();window.toggleAccordion=b;document.body.appendChild(F({target:"main.html"}));document.getElementById("navbar").appendChild(U());
