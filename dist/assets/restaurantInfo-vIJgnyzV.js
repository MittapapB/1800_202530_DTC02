import{d as n,c as w,q as D,p as M,t as $,g as I,i as E,b as x,o as _,a as C,v as j,n as H,w as T}from"./firebaseConfig-BGUxOqTk.js";/* empty css              */import{B as N}from"./BackButton-VMeNE0XH.js";import"./confirm-modal-Djzis-F8.js";import{N as S}from"./Navbar-CLB9A0dp.js";const B=sessionStorage.getItem("lastPage"),R=N({target:"main.html"});B&&B.includes("favorites.html")&&(R.onclick=()=>history.back());document.body.appendChild(R);const p="/images/default-avatar.jpg";async function F(){const e=new URLSearchParams(window.location.search),a=decodeURIComponent(e.get("restaurant-id")||""),t=document.getElementById("comments-container");if(t){t.innerHTML="<p class='text-gray-500 text-center'>Loading...</p>";try{if(!a){console.warn("fetchUserComments: missing restaurant-id query param"),t.innerHTML="<p class='text-gray-500 text-center'>No restaurant specified.</p>";return}if(!n||typeof n!="object")throw console.error("fetchUserComments: 'db' is not a Firestore instance:",n),new Error("Invalid Firestore instance");const r=w(n,"restaurant",a,"time_record"),L=D(r,M("submitted_at","desc"),$(5)),b=await I(L);if(b.empty){t.innerHTML="<p class='text-gray-500 text-center'>No comments yet.</p>";return}t.innerHTML="";const k=b.docs.map(async d=>{const s=d.data(),u=s.user_id;let o={name:"Anonymous",avatar:p};if(u){const m=await E(x(n,"users",u));if(m.exists()){const g=m.data();o.name=g.name||"Anonymous",o.avatar=g.avatar||p}}let f="-";return s.visit_timestamp&&s.visit_timestamp.toDate&&(f=s.visit_timestamp.toDate().toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),{record:s,user:o,visitTime:f}});(await Promise.all(k)).forEach(({record:d,user:s,visitTime:u})=>{const o=document.createElement("div");o.className="flex items-start gap-4 p-4 mb-4 bg-white rounded-2xl shadow-sm border border-gray-100";const f=s.avatar||p,m=5,g=d.rating||0,A=Array.from({length:m},(G,U)=>`<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 ${U<g?"fill-current text-[#89AC46]":"text-gray-300"}" viewBox="0 0 24 24"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.917 1.536 8.277L12 18.896l-7.472 4.604 1.536-8.277L0 9.306l8.332-1.151z"/></svg>`).join("");o.innerHTML=`
        <img src="${f}" alt="User avatar" class="w-12 h-12 rounded-full object-cover border border-gray-200" />
        <div class="flex-1">
          <div class="flex justify-between items-center">
            <h4 class="font-semibold text-title">${s.name||"Anonymous"}</h4>
            <p class="text-sm text-gray-500 font-semibold flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#EB6424]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 6v6l4 2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>

              Waited: <span class="font-bold text-[#EB6424]">${d.wait_time_minutes||"-"} min</span>
            </p>
          </div>
          <div class="flex items-center mt-1 mb-2">${A}</div>
          <p class="text-gray-700 text-sm md:text-base leading-relaxed">
            ${d.comments||"(No comment)"}
          </p>
           <p class="text-gray-400 text-xs mt-1">Visited: ${u}</p> 
        </div>
      `,t.appendChild(o)})}catch(r){console.error(r),t.innerHTML="<p class='text-red-500 text-center'>Failed to load comments.</p>"}}}F();const P=new URL(window.location.href),c=decodeURIComponent(P.searchParams.get("restaurant-id"));let y="";const q=document.getElementById("fav-btn"),v=document.getElementById("fav-path");let l=null,i=null;_(C,async e=>{e&&(l=e,await O(),q.addEventListener("click",W))});async function O(){const e=w(n,"users",l.uid,"favorite_list"),a=await I(e);i=null,a.forEach(t=>{t.data().restaurant_id===c&&(i=t.id)}),h(i!==null)}function h(e){e?(v.setAttribute("fill","#EB6424"),v.setAttribute("stroke","#EB6424")):(v.setAttribute("fill","none"),v.setAttribute("stroke","currentColor"))}async function W(){if(!l)return;const e=document.getElementById("confirm-modal");if(!i){e.open("Add",`Add ${y} to your favorites?`,async()=>{i=(await j(w(n,"users",l.uid,"favorite_list"),{restaurant_id:c,created_at:T()})).id,h(!0)});return}e.open("Remove",`Remove ${y} from your favorites?`,async()=>{await H(x(n,"users",l.uid,"favorite_list",i)),i=null,h(!1)})}function z(){if(!c)return;const e=document.getElementById("add-record-btn");e&&_(C,a=>{a?e.href=`./add-record.html?restaurant-id=${encodeURIComponent(c)}`:e.href="./sign-in.html"})}async function Q(){try{const e=x(n,"restaurant",c),a=await E(e);if(!a.exists())return;const t=a.data();y=t.name,t.cuisine||(document.getElementById("overview-cuisine").classList.remove("inline-flex"),document.getElementById("overview-cuisine").classList.add("hidden")),document.getElementById("restaurant-name").textContent=t.name,document.getElementById("overview-name").textContent=t.name,document.getElementById("overview-cuisine").textContent=t.cuisine,document.getElementById("overview-address").textContent=t.address,document.getElementById("overview-avg").textContent=t.avg_wait_time.toFixed(1);const r=document.getElementById("restaurant-img");r&&(r.src=t.image_url||"/images/MealWaveLogo.png",r.alt=t.name||"Restaurant")}catch(e){console.error("Error loading restaurant:",e)}}c&&(Q(),z());document.getElementById("navbar").appendChild(S());
